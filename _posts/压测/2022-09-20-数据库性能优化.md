---
layout:     post
title:      压测之数据库性能优化
subtitle:   压测时数据库负载高时，针对服务进行数据库优化
date:       2022-09-20
author:     Erain
header-img: img/home-bg.jpg
categories: 数据库
catalog: true
tags:
    - 面试
    - 压测
---

# 零点重置
- **需求**    
  实现某个业务，在零点的时候重置回初始状态。如: 每天只能抽奖一次
- **实现**    
  设立HasDone字段，默认值为false，若当天已抽奖，则设置为true。每当零点的时候，重新设置为false。因为此数据为用户数据，挂靠在用户身上，所以数据落库。
- **瓶颈**    
  极限行为: 当大量用户集中抽奖并且集中在零点进行边抽奖边重置时，概率失败。事务需要排队，导致用户响应耗时增加。
- **优化**    
  优化方向: 将集中行为转化成独立行为。集中操作库-->分散操作库   
  将**HasDone字段**修改为**时间戳**，记录上次操作的时间，并将此时间入库，每次用户请求时，逻辑校验: 上次操作的时间>今日的零点时间戳，则今日已操作。减少了在零点的并发处理，只在用户请求时才校验，对于事务的处理，代码的逻辑处理耗时几乎忽略不计。
