---
layout:     post
title:      Redis如何测试
subtitle:   缓存、队列、订阅
date:       2022-09-08
author:     Erain
header-img: img/home-bg.jpg
categories: 测试
catalog: true
tags:
  - Redis
  - 测试
---
# redis要怎么测试？

[原文地址](https://blog.csdn.net/xueningyang555/article/details/120862998)

- 缓存怎么测试？
- 队列怎么测试？
- 订阅怎么测试？

## 缓存

1. **缓存的分类**    
   缓存有几种类型：文件缓存，数据库缓存，内存缓存，浏览器缓存。如网页缓存，数据的代码缓存，redis缓存。
1. **缓存的作用**    
   加快访问速度、减少服务器和db压力。如一些实时变更的数据：排行榜等
1. **缓存的使用场景**
    1. 当接口的qps较高（比如超过100）或者对响应速度有要求，或者服务器性能、db性能较差的，都可以尝试使用缓存解决问题。
    1. 修改频率很低的数据，如数据库配置
    1. 实时性强、数据量大的数据。特别是数据处理中夹杂算法或排序的，如游戏中的排行榜、电商的销售情况统计
1. **缓存的生成方式**
    1. **外缓存**    
       针对请求参数多变，返回的数据如果跟请求参数强相关，适合在“外面”（请求参数过滤之后）缓存查询到的数据，这类数据一般缓存时间短，比如缓存5分钟。
       主要应对相同请求参数在短时间内的重复请求。如果遇到请求攻击，即使这个缓存有效期只有1秒，也是很有效的，能挡住大量的请求。 这种处理方式可以大大减少数据库的压力。常见的场景有：排行榜、赠送道具(强交互性)等。
       ![](/img/post/数据库/外缓存.png)
    1. **内缓存**         
       针对请求参数变化不大，返回的数据跟db中存储的数据很接近的情况，适合在“里面”缓存数据，也就是在更新db的同时更新缓存，
       这种情况最优的状态下，只需要读缓存就够了，不需要跟db直接交互，能大大缓解db压力。这种缓存有效期可以设置很长。
       ![](/img/post/数据库/内缓存.png)
1. **缓存的更新方式**
    1. 设置缓存有效期，通过新的请求自动创建新的缓存。
    1. 删除缓存，更新db数据后，通过新的请求自动创建新的缓存。
    1. 重新设置缓存：在更新db数据后，直接重新设置缓存。

## 缓存的测试

### 性能测试

1. **验证使用缓存的功能是否正确，查看缓存数据**
    1. 通过日志打印
    1. 后门接口工具
    1. 命令行查看，memcached和redis可以登录后，直接查看
1. **利用缓存删除反向验证功能**
    1. 缓存有效，验证相关业务
    1. 缓存被删除，验证相关业务
    1. 缓存过期，memcached和redis可以设置失效时间，验证相关业务
1. **超量淘汰机制**：缓存达到上限后的逻辑处理（或是更新或是指定缓存量级）
1. **缓存穿透**
1. **缓存雪崩**
1. **redis缓存服务被停掉**
1. **缓存超时**
1. **缓存闪照**

### Redis功能测试

1. redis数据生效时，读取是否正确
2. redis数据不存在，能否正常从db中读取到正确的值，并正确写入Redis和返回给上层
3. 数据在redis和db中都不存在时的表现是否正常
4. 删除数据时，redis和db的数据是否一致