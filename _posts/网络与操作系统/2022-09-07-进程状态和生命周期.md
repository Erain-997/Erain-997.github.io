---
layout:     post
title:      进程和生命周期
subtitle:   进程的各个状态
date:       2022-09-07
author:     Erain
header-img: img/home-bg.jpg
categories: 网络与操作系统
catalog: true
tags:
  - 操作系统
---

# 进程状态和生命周期

## 生命周期

进程的生命周期包括：进程创建-进程运行-进程等待-进程唤醒-进程结束

### 引起进程创建的三个主要事件：

1. 系统初始化：在我们启动计算机的时候，计算机会进行初始化，初始化的工作就需要进程来完成。
2. 用户请求创建某个进程
3. 进程在执行过程中创建新的进程

### 进程创建时操作系统的行为：

1.操作系统创建并初始化一个PCB（包括申请内存，填充数据等）

2.将PCB插入就绪队列

主要可以分为四步：

    1.申请一块空白的PCB。（当然，并不是完全空白，会获得该进程的pid，即唯一标识，然后将该进程添加进进程表中，通过pid来识别，让操作系统知道该进程的存在）
    
    2.为进程和PCB分配空间。操作系统必须知道私有用户地址空间（程序和数据）和用户栈需要多少空间。默认情况下会根据进程的类型分配这些值，也可以在作业创建时基于用户请求设置这些值。
    
    3.初始化进程控制块。进程标识符部分包括进程ID和其他相关的ID，如父进程的ID等；处理器的状态信息大多初始化为0，但程序计数器和系统栈指针除外。进程最初不拥有任何资源，除非显式的请求了这些资源或继承了了父进程的资源。
    
    4.将进程插入就绪队列

### 进程等待：

触发进程等待的情况：

    1.申请了某系统操作，不能马上完成
    
    2.启动某种操作，无法马上完成；
    
    3.需要某些数据，没有获得

    需要注意的是，进程只能自己阻塞自己，因为只有进程自己才知道何时需要等待某事件发生

### 进程唤醒：

进程被唤醒的情况：

    1.被阻塞进程等待的事件已经发生
    
    2.被阻塞进程需要的资源已被满足
    
    3.将该进程的PCB插入到就绪队列中去
    
    注意：进程只能被别的进程或者OS唤醒

### 进程结束：

进程结束有四种情况：

    1.程序执行结束退出，执行结果正常
    
    2.程序执行结束退出，但是结果不正常
    
    3.程序未能完整执行，发生错误，强制退出
    
    4.被其他进程杀死

进程退出是有状态的，操作系统和父进程在回收子进程资源的时候，需要知道这些状态，怎么办呢？于是有了退出码和退出状态信息。退出状态会由一个退出状态码来表示，如果为0那么说明是正常退出的，这时我们看退出码进一步获得信息。退出码的意义是可以帮助我们判断程序运行完时结果是正确还是错误，一般0代表结果正确，!
0代表结果错误，而程序崩溃后退出码会变得没有意义。

#### 进程终止处理步骤：

    1.根据进程终止的标识符, 从 PCB 中读取进程状态
    
    2.将进程以及进程的子孙进程终止
    
    3.将终止进程的所有资源归还给父进程和操作系统
    
    4.将 PCB 从进程队列中移除

# 进程状态

在进程的生命周期中，进程在不同的状态间来回切换，最基本的有三种进程状态

**就绪状态**：进程已经获得了除CPU使用权以外的所有资源，该进程的PCB被放在就绪队列中，一旦获得CPU资源，立马得到执行。

**阻塞状态**：因为进程运行所需要的资源还没有得到满足，或者进程因为发生某个事件而暂停执行时的状态（如：请求I/O、申请缓冲空间等）。有时也称“等待”状态或“睡眠”状态。

（这里阻塞状态还可以继续细分分为：可中断阻塞状态，不可中断阻塞状态，暂停状态。这里就不细说了）

**运行状态**：指进程已获得处理机而执行的状态。

进程还有其它的基本状态，包括，

    ->创建状态(new)，一个进程正在被创建，还没被转到就绪状态之前的状态。 
    ->结束状态(exit)，一个进程正在从系统中消失时的状态。

## 抢占式和非抢占式

抢占式。现行进程在运行过程中，如果有重要或紧迫的进程到达（其状态必须为就绪），则现运行进程将被迫放弃处理器，系统将处理器立刻分配给新到达的进程。作为进程调度方式之一，还有一种称为非抢占式。

* **非抢占式（Nonpreemptive）**
    1. 让进程运行直到结束或阻塞的调度方式
    1. 容易实现
    1. 适合专用系统，不适合通用系统

* **抢占式（Preemptive）**
    1. 允许将逻辑上可继续运行的在运行过程暂停的调度方式
    1. 可防止单一进程长时间独占CPU
    1. 系统开销大（降低途径：硬件实现进程切换，或扩充主存以贮存大部分程序）